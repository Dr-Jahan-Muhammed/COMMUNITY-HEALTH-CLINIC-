<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Community Health Clinic</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Roboto',sans-serif}
body{background:#f8fafc;color:#222;transition:.3s;position:relative}
body.dark{background:#121212;color:#f1f1f1}

/* ===== ROTATED  ===== */
#sidebar-wrapper {
  position: fixed;
  left: 0;
  top: 50%;
  transform: translateY(-50%);
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  z-index: 2000;
}

#sidebar {
  writing-mode: vertical-rl; /* rotates text 90¬∞ */
  text-orientation: mixed;
  background-color: #16a34a; /* green for CHC */
  padding: 8px 12px;
  border-radius: 0 12px 12px 0;
}
#sidebar-toggle-wrapper {
  margin-top: 12px; /* space below the sidebar tab */
}
    
.sidebar-btn {
  font-weight: 700;
  font-size: 12px;
  color: #fff;
  white-space: nowrap;
}

/* Move toggle below the sidebar */
#sidebar-toggle-wrapper {
  margin-top: 12px;
  display: flex;
  justify-content: center;
  width: 100%;
}

.sidebar-theme {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  border: none;
  background: #facc15;
  color: #111;
  display: flex; justify-content: center; align-items: center;
  cursor: pointer;
  font-size: 14px;
}

/* ===== MAIN ===== */
#main{
  margin-left:0;
  padding:0 16px;
}

/* ===== WELCOME ===== */
#welcome{
  position:fixed; inset:0;
  background:rgba(255,255,255,.95);
  display:flex; flex-direction:column;
  justify-content:center; align-items:center;
  z-index:9999;
  animation:fadeOut 1.2s ease forwards;
  animation-delay:2.5s;
}
@keyframes fadeOut{
  to{opacity:0;transform:translateY(-20px);pointer-events:none}
}
#welcome h1{font-size:42px}
#welcome p{margin-top:10px;font-style:italic;color:#555}

/* ===== HEADER ===== */
header{
  position:sticky;top:0;
  background:#fff;
  padding:14px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:6px;
  z-index:1000;
  transition:.3s;
}
header.scrolled{
  background:rgba(255,255,255,.7);
  backdrop-filter:blur(10px);
}
body.dark header{background:#1e1e1e}

.since{font-size:12px;color:#777}
body.dark .since{color:#aaa}

.clinic-name{
  font-size:22px;font-weight:700;
  display:flex;align-items:center;
  justify-content:center;
  white-space:nowrap;
}
.clinic-name img{
  height:1.1em;
  width:auto;
  margin-left:6px;
}

.address{font-size:13px;color:#666;margin-top:2px}
body.dark .address{color:#bbb}

.contact{font-size:13px;margin-top:2px;color:#2563eb}

/* ===== OP BADGE ===== */
.op-badge{
  margin-top:6px;padding:4px 8px;border-radius:12px;font-size:12px;font-weight:600;color:white;
}

/* ===== ROTATING QUOTES ===== */
#rotating-quote{
  text-align:center;
  font-style:italic;
  font-size:16px;
  margin:16px 0;
  color:#16a34a;
  transition:.3s;
}
body.dark #rotating-quote{color:#facc15}

/* ===== SECTIONS ===== */
section{padding:20px 16px}
.section-title{text-align:center;font-size:20px;font-weight:600;margin-bottom:14px}

/* ===== SERVICES ===== */
.services{
  display:grid;
  grid-template-columns:repeat(4,140px);
  gap:16px;
  justify-content:center;
}
.service-card{
  background:#fff;
  padding:14px;border-radius:14px;
  box-shadow:0 4px 10px rgba(0,0,0,.05);
  text-align:center;font-size:14px;
  display:flex;
  flex-direction:column;
  align-items:center;
}
body.dark .service-card{background:#222;color:#eee}
.service-card img{width:40px;height:40px;margin-bottom:6px}

/* ===== MOBILE ===== */
@media(max-width:640px){
  .services{grid-template-columns:repeat(2,140px)}
  #sidebar-wrapper{left:0; top:50%; transform:translateY(-50%) scale(0.85)}
}
</style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>

<!-- SIDEBAR WRAPPER -->
<div id="sidebar-wrapper">
  <div id="sidebar">
    <div class="sidebar-btn current">COMMUNITY HEALTH CLINIC</div>
  </div>
  <div id="sidebar-toggle-wrapper">
    <button class="sidebar-theme" id="themeToggle">‚òÄÔ∏è</button>
  </div>
</div>

<!-- MAIN -->
<div id="main">

<!-- WELCOME -->
<div id="welcome">
  <h1>WELCOME</h1>
  <p id="quote">Health is the real wealth.</p>
</div>

<header id="header">
  <div class="since">Since 2003</div>
  <div class="clinic-name">
    COMMUNITY HEALTH CLINIC
    <img src="https://cdn-icons-png.flaticon.com/512/4006/4006511.png" alt="Clinic Icon">
  </div>
  <div class="address">Cheenimukku, Poonoor</div>
  <div class="contact">üìû 9961252798</div>
  <span id="opBadge" class="op-badge">OPEN</span>
</header>

<!-- ROTATING QUOTE -->
<div id="rotating-quote">‚ÄúHealth is the real wealth.‚Äù</div>

<section>
  <div class="section-title">Services</div>
  <div class="services">
    <div class="service-card">
      <img src="https://img.icons8.com/color/48/000000/stethoscope.png">
      General OP
    </div>
    <div class="service-card">
      <img src="https://img.icons8.com/color/48/000000/lungs.png">
      Nebulisation
    </div>
    <div class="service-card">
      <img src="https://img.icons8.com/color/48/000000/heart-with-pulse.png">
      ECG
    </div>
    <div class="service-card">
      <img src="https://cdn-icons-png.flaticon.com/512/4006/4006511.png">
      IV Fluids
    </div>
    <div class="service-card">
      <img src="https://img.icons8.com/color/48/000000/oxygen.png">
      Oxygen
    </div>
    <div class="service-card">
      <img src="https://img.icons8.com/color/48/000000/wound.png">
      Wound Care
    </div>
    <div class="service-card">
      <img src="https://img.icons8.com/color/48/000000/surgical-scissors.png">
      Minor Procedures
    </div>
    <div class="service-card">
      <img src="https://img.icons8.com/color/48/000000/test-tube.png">
      Lab Collection
    </div>
    <div class="service-card">
      <img src="https://img.icons8.com/color/48/000000/home.png">
      Home Visit
    </div>
  </div>
</section>

</div> <!-- MAIN END -->

<script>
/* ===== ROTATING QUOTES ===== */
const quotes=[
 "The greatest wealth is health. ‚Äì Hippocrates",
 "An ounce of prevention is worth a pound of cure. ‚Äì Benjamin Franklin",
 "It is health that is real wealth and not pieces of gold and silver. ‚Äì Mahatma Gandhi",
 "To keep the body in good health is a duty‚Ä¶ otherwise we shall not be able to keep our mind strong and clear. ‚Äì Buddha",
 "A healthy outside starts from the inside. ‚Äì Robert Urich",
 "The doctor of the future will give no medicine but will interest his patients in the care of the human frame, diet and in the cause and prevention of disease. ‚Äì Thomas Edison",
 "Health is a state of complete harmony of the body, mind, and spirit. ‚Äì B.K.S. Iyengar",
 "The art of medicine consists of amusing the patient while nature cures the disease. ‚Äì Voltaire"
];
let i=0;
const quoteEl=document.getElementById("rotating-quote");
setInterval(()=>{
 quoteEl.textContent = quotes[i];
 i=(i+1)%quotes.length;
},4000);

/* ===== HEADER SCROLL EFFECT ===== */
const header=document.getElementById("header");
window.addEventListener("scroll",()=>header.classList.toggle("scrolled",scrollY>10));

/* ===== THEME TOGGLE ===== */
const themeBtn = document.getElementById("themeToggle");
themeBtn.addEventListener("click",()=>{
 document.body.classList.toggle("dark");
 if(document.body.classList.contains("dark")){
   themeBtn.textContent = "üåô";
   themeBtn.style.background = "#333";
   themeBtn.style.color = "#facc15";
 } else {
   themeBtn.textContent = "‚òÄÔ∏è";
   themeBtn.style.background = "#facc15";
   themeBtn.style.color = "#111";
 }
});

/* ===== OP BADGE ===== */
function updateOPBadge() {
  const badge = document.getElementById("opBadge");
  const now = new Date();
  const day = now.getDay(); // 0=Sun
  const hour = now.getHours();
  let isOpen = false;
  if(day===0 && hour>=9 && hour<20) isOpen=true;
  else if(day>=1 && day<=6 && hour>=9 && hour<23) isOpen=true;
  badge.textContent = isOpen ? "OPEN" : "CLOSED";
  badge.style.backgroundColor = isOpen ? "#16a34a" : "#dc2626"; // green/red
}
updateOPBadge();
setInterval(updateOPBadge,60000);
</script>
<!-- ===== PHASE 2: TOKEN SYSTEM ===== -->

<style>
/* ===== TOKEN SYSTEM STYLES ===== */
.token-container{display:flex;flex-direction:column;align-items:center;justify-content:center;max-width:400px;margin:20px auto;padding:20px}
.token-box{background:white;padding:20px;border-radius:18px;box-shadow:0 8px 20px rgba(0,0,0,.08);width:100%;transition:.3s}
body.dark .token-box{background:#1e1e1e;color:#f0f0f0}
.token-box input,.token-box select{width:100%;padding:10px;margin-bottom:10px;border-radius:10px;border:1px solid #ddd}
.token-box button{width:100%;padding:12px;border:none;border-radius:12px;background:#16a34a;color:white;font-size:16px;cursor:pointer}
.token-display{margin-top:16px;padding:18px;background:#ecfeff;border-radius:18px;text-align:center;position:relative;overflow:hidden;min-width:220px;display:none}
.ribbon{position:absolute;top:10px;width:200%;height:6px;background:linear-gradient(90deg,#22c55e,#3b82f6,#22c55e);animation:ribbon 4s linear infinite}
@keyframes ribbon{from{transform:translateX(-50%)}to{transform:translateX(0)}}
.token-number{font-size:36px;font-weight:800}
.token-date{font-size:14px;color:#555}
.print-btn{margin-top:14px;width:100%;padding:14px;border:none;border-radius:16px;background:linear-gradient(135deg,#16a34a,#22c55e);color:white;font-size:16px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;box-shadow:0 8px 20px rgba(22,163,74,0.35);transition:transform .2s, box-shadow .2s}
.print-btn:hover{transform:translateY(-2px);box-shadow:0 12px 26px rgba(22,163,74,0.45)}
body.dark .print-btn{background:linear-gradient(135deg,#22c55e,#4ade80)}
.dashboard{background:white;padding:16px;border-radius:16px;box-shadow:0 6px 16px rgba(0,0,0,.08);display:none;max-width:400px;margin:20px auto}
body.dark .dashboard{background:#1e1e1e;color:#f0f0f0}
.dashboard ul{padding-left:16px;max-height:200px;overflow-y:auto}
.dashboard button{margin-top:10px;padding:10px;width:100%;border:none;border-radius:10px;background:#dc2626;color:white;cursor:pointer}
    
/* ===== AUTHORIZED ACCESS ===== */
.auth-container{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  max-width:400px;
  margin:20px auto;
  padding:20px;
}
.auth-box{
  background:white;
  padding:20px;
  border-radius:18px;
  box-shadow:0 8px 20px rgba(0,0,0,.08);
  width:100%;
  transition:.3s;
}
body.dark .auth-box{
  background:#1e1e1e;
  color:#f0f0f0;
}
.auth-box input, .auth-box button{
  width:100%;
  padding:10px;
  margin-bottom:10px;
  border-radius:10px;
  border:1px solid #ddd;
}
.auth-box button{
  background:#16a34a;
  color:white;
  font-size:16px;
  cursor:pointer;
  border:none;
}
.dashboard{
  background:white;
  padding:16px;
  border-radius:16px;
  box-shadow:0 6px 16px rgba(0,0,0,.08);
  display:none;
  max-width:400px;
  margin-top:16px;
}
body.dark .dashboard{background:#1e1e1e;color:#f0f0f0}
.dashboard ul{padding-left:16px;max-height:200px;overflow-y:auto}
.dashboard button{
  margin-top:10px;
  padding:10px;
  width:100%;
  border:none;
  border-radius:10px;
  background:#dc2626;
  color:white;
  cursor:pointer;
}
</style>
    
<section class="token-container">
  <div class="section-title">Take Token (<span id="nextDate"></span>)</div>
  <div class="token-box">
    <input id="patientName" placeholder="Patient Name">
    <input id="age" type="number" placeholder="Age">
    <select id="sex">
      <option value="">Sex</option>
      <option>Male</option>
      <option>Female</option>
      <option>Other</option>
    </select>
    <input id="mobile" placeholder="Mobile Number">
    <div id="tokenCountDisplay" style="margin-bottom:8px;font-size:14px;color:#555"></div>
  <button onclick="takeToken()">Take Token</button>
  </div>

  <div id="tokenResult" class="token-display">
    <div class="ribbon"></div>
    <div class="token-number" id="tokenNo"></div>
    <div class="token-date" id="tokenDate"></div>
    <button class="print-btn" onclick="downloadToken()">‚¨áÔ∏è Download Token</button> </div>
</section>
<section class="auth-container">
  <div class="section-title">Authorized Access</div>
  <div class="auth-box">
    <input id="pinInput" type="password" placeholder="Enter PIN">
    <button onclick="checkPin()">Enter</button>
  </div>
  <div id="dashboard" class="dashboard">
    <h4>Tokens</h4>
    <ul id="tokenList"></ul>
    <button id="masterBtn" onclick="clearAll()">Delete All Records</button>
  </div>
</section>
<script>
/* ============================
   CONFIGURATION
   ============================ */
const AUTH_PIN = "1234"; // change later

/* ============================
   NEXT TOKEN DATE LOGIC
   ============================ */
function getNextWorkingDate() {
  const now = new Date();
  let target = new Date(now);

  // Always start from tomorrow
  target.setDate(target.getDate() + 1);

  // If next day is Sunday ‚Üí skip to Monday
  if (target.getDay() === 0) {
    target.setDate(target.getDate() + 1);
  }

  return target;
}

// todayKey is used for display and storage
const todayKey = getNextWorkingDate().toDateString();

// Set the date above the form after DOM is ready
document.addEventListener("DOMContentLoaded", function() {
  const dateSpan = document.getElementById("nextDate");
  if (dateSpan) dateSpan.textContent = todayKey;
});

/* ============================
   STORAGE FUNCTIONS
   ============================ */
function getTokens() {
  return JSON.parse(localStorage.getItem("tokens_" + todayKey)) || [];
}

function saveTokens(tokens) {
  localStorage.setItem("tokens_" + todayKey, JSON.stringify(tokens));
}

/* ============================
   TOKEN COUNT
   ============================ */
function updateTokenCount() {
  const count = getTokens().length;
  const display = document.getElementById("tokenCountDisplay");
  if (display) display.textContent = `Tokens issued: ${count}`; // unlimited
}

updateTokenCount();

/* ============================
   TAKE TOKEN
   ============================ */
function takeToken() {
  const name = document.getElementById("patientName").value.trim();
  const age = document.getElementById("age").value.trim();
  const sex = document.getElementById("sex").value;
  const mobile = document.getElementById("mobile").value.trim();

  if (!name || !age || !sex || !mobile) {
    alert("Please fill all fields");
    return;
  }

  const now = new Date();

  // Use the unified todayKey for token date
  const tokenDateKey = todayKey;

  // Load tokens
  const tokenData = getTokens();

  const tokenNumber = tokenData.length + 1;

  const token = {
    token: tokenNumber,
    name,
    age,
    sex,
    mobile,
    date: tokenDateKey,
    time: now.toLocaleTimeString()
  };

  tokenData.push(token);
  saveTokens(tokenData);

  // Display token
  document.getElementById("tokenNo").textContent = "TOKEN " + tokenNumber;
  document.getElementById("tokenDate").textContent = "Date: " + tokenDateKey;
  document.getElementById("tokenResult").style.display = "block";

  updateTokenCount();
}

/* ============================
   DOWNLOAD TOKEN
   ============================ */
async function downloadToken() {
  const { jsPDF } = window.jspdf;

  const doc = new jsPDF({
    unit: "px",
    format: [300, 500] // width x height of token
  });

  // --- Fetch token details ---
  const tokenNo = document.getElementById("tokenNo").innerText;
  const tokenDate = document.getElementById("tokenDate").innerText.replace("Date: ", "");
  const name = document.getElementById("patientName").value;
  const age = document.getElementById("age").value;
  const sex = document.getElementById("sex").value;

  // --- Load header icon ---
  const iconUrl = "https://cdn-icons-png.flaticon.com/512/4006/4006511.png";
  const img = new Image();
  img.crossOrigin = "anonymous";
  img.src = iconUrl;
  await new Promise(resolve => img.onload = resolve);

  // --- HEADER REPLICA ---
  doc.addImage(img, "PNG", 20, 20, 35, 35); // icon left
  doc.setFont("helvetica", "bold");
  doc.setFontSize(14);
  doc.text("COMMUNITY HEALTH CLINIC", 100, 35); // aligned with icon
  doc.setFontSize(10);
  doc.setFont("helvetica", "normal");
  doc.text("Since 2003", 100, 50);
  doc.text("Cheenimukku, Poonoor", 100, 65);
  doc.text("üìû 9961252798", 100, 80);

  // --- Dashed line below header ---
  doc.setLineWidth(0.5);
  const dash = [3, 3];
  doc.setLineDash(dash, 0);
  doc.line(20, 90, 280, 90);
  doc.setLineDash([]); // reset to solid for rest

  // --- TOKEN DETAILS ---
  doc.setFontSize(12);
  doc.text(`Name: ${name}`, 20, 110);
  doc.text(`Age: ${age}`, 20, 130);
  doc.text(`Sex: ${sex}`, 20, 150);

  doc.setLineWidth(0.5);
  doc.line(20, 160, 280, 160);

  doc.setFontSize(24);
  doc.setFont("helvetica", "bold");
  doc.text(`${tokenNo}`, 100, 190);

  doc.setFontSize(10);
  doc.setFont("helvetica", "normal");
  doc.text(tokenDate, 20, 220);
  doc.text("Please wait for your turn", 20, 240);

  // --- DOWNLOAD PDF ---
  doc.save(`${name}_Token.pdf`);
}
          
/* ============================
   AUTHENTICATION
   ============================ */
function checkPin() {
  const pin = document.getElementById("pinInput").value;
  if (pin !== AUTH_PIN) {
    alert("Incorrect PIN");
    return;
  }
  document.getElementById("dashboard").style.display = "block";
  loadDashboard();
}

/* ============================
   DASHBOARD
   ============================ */
function loadDashboard() {
  const list = document.getElementById("tokenList");
  list.innerHTML = "";

  const tokens = getTokens();

  if (tokens.length === 0) {
    list.innerHTML = "<li>No tokens</li>";
    return;
  }

  tokens.forEach(t => {
    const li = document.createElement("li");
    li.textContent = `#${t.token} - ${t.name} (${t.age}, ${t.sex})`;
    list.appendChild(li);
  });
}

/* ============================
   CLEAR ALL
   ============================ */
function clearAll() {
  if (!confirm("Delete all tokens for today?")) return;
  localStorage.removeItem("tokens_" + todayKey);
  loadDashboard();
  updateTokenCount();
}
</script>
</body>
</html>
